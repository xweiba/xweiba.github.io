{"title":"L2TP 一键安装","uid":"09f59e5fce202be3798507faef5e8740","slug":"L2TP 一键安装","date":"2019-07-26T05:32:05.000Z","updated":"2025-04-30T08:11:18.861Z","comments":true,"path":"api/articles/L2TP 一键安装.json","keywords":null,"cover":null,"content":"<p>使用他的一键脚本 <a href=\"https://teddysun.com/448.html/comment-page-6#comments\">https://teddysun.com/448.html/comment-page-6#comments</a></p>\n<p>如果你要想对用户进行操作，可以使用如下命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">l2tp -a 新增用户</span><br><span class=\"line\">l2tp -d 删除用户</span><br><span class=\"line\">l2tp -m 修改现有的用户的密码</span><br><span class=\"line\">l2tp -l 列出所有用户名和密码</span><br><span class=\"line\">l2tp -h 列出帮助信息</span><br></pre></td></tr></table></figure>\n\n<p>其他事项：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、脚本在安装完成后，已自动启动进程，并加入了开机自启动。</span><br><span class=\"line\">2、脚本会改写 iptables 或 firewalld 的规则。</span><br><span class=\"line\">3、脚本安装时，会即时将安装日志写到 /root/l2tp.log 文件里，如果你安装失败，可以通过此文件来寻找错误信息。</span><br></pre></td></tr></table></figure>\n\n<p>使用命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipsec status （查看 IPSec 运行状态）</span><br><span class=\"line\">ipsec verify （查看 IPSec 检查结果）</span><br><span class=\"line\">/etc/init.d/ipsec start|stop|restart|status （CentOS6 下使用）</span><br><span class=\"line\">/etc/init.d/xl2tpd start|stop|restart （CentOS6 下使用）</span><br><span class=\"line\">systemctl start|stop|restart|status ipsec （CentOS7 下使用）</span><br><span class=\"line\">systemctl start|stop|restart xl2tpd （CentOS7 下使用）</span><br><span class=\"line\">service ipsec start|stop|restart|status （Debian/Ubuntu 下使用）</span><br><span class=\"line\">service xl2tpd start|stop|restart （Debian/Ubuntu 下使用）</span><br></pre></td></tr></table></figure>\n\n<p>L2TP debug 模式: </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">先关闭 L2TP : systemctl stop xl2tpd</span><br><span class=\"line\">已Debug模式启动 : /usr/sbin/xl2tpd -D</span><br></pre></td></tr></table></figure>\n\n\n<p>一键脚本</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --no-check-certificate https://raw.githubusercontent.com/teddysun/across/master/l2tp.sh</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> +x l2tp.sh</span><br><span class=\"line\">./l2tp.sh</span><br></pre></td></tr></table></figure>\n\n<p><code>options.xl2tpd</code> 配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@host xl2tpd]# cat /etc/ppp/options.xl2tpd </span><br><span class=\"line\">ipcp-accept-local</span><br><span class=\"line\">ipcp-accept-remote</span><br><span class=\"line\">require-mschap-v2</span><br><span class=\"line\">ms-dns 8.8.8.8</span><br><span class=\"line\">ms-dns 8.8.4.4</span><br><span class=\"line\">noccp</span><br><span class=\"line\">auth</span><br><span class=\"line\">hide-password</span><br><span class=\"line\">idle 1800</span><br><span class=\"line\">mtu 1410</span><br><span class=\"line\">mru 1410</span><br><span class=\"line\">nodefaultroute</span><br><span class=\"line\">debug</span><br><span class=\"line\">proxyarp</span><br><span class=\"line\">connect-delay 5000</span><br><span class=\"line\"></span><br><span class=\"line\">#防止两分钟掉线</span><br><span class=\"line\">lcp-echo-interval 0</span><br><span class=\"line\">lcp-echo-failure 0</span><br><span class=\"line\"></span><br><span class=\"line\">[root@host xl2tpd]# </span><br></pre></td></tr></table></figure>\n\n<p><code>/etc/ipsec.conf</code> 配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@host xl2tpd]# cat /etc/ipsec.conf</span><br><span class=\"line\">version 2.0</span><br><span class=\"line\"></span><br><span class=\"line\">config setup</span><br><span class=\"line\">    protostack=netkey</span><br><span class=\"line\">    nhelpers=0</span><br><span class=\"line\">    uniqueids=no</span><br><span class=\"line\">    interfaces=%defaultroute</span><br><span class=\"line\">    virtual_private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12,%v4:!192.168.18.0/24</span><br><span class=\"line\"></span><br><span class=\"line\">conn l2tp-psk</span><br><span class=\"line\">    rightsubnet=vhost:%priv</span><br><span class=\"line\">    also=l2tp-psk-nonat</span><br><span class=\"line\"></span><br><span class=\"line\">conn l2tp-psk-nonat</span><br><span class=\"line\">    authby=secret</span><br><span class=\"line\">    pfs=no</span><br><span class=\"line\">    auto=add</span><br><span class=\"line\">    keyingtries=3</span><br><span class=\"line\">    rekey=no</span><br><span class=\"line\">    ikelifetime=8h</span><br><span class=\"line\">    keylife=1h</span><br><span class=\"line\">    type=transport</span><br><span class=\"line\">    left=%defaultroute</span><br><span class=\"line\">    leftid=93.179.100.194</span><br><span class=\"line\">    leftnexthop=%defaultroute</span><br><span class=\"line\">    leftprotoport=17/1701</span><br><span class=\"line\">    right=%any</span><br><span class=\"line\">    rightprotoport=17/%any</span><br><span class=\"line\">    dpddelay=40</span><br><span class=\"line\">    dpdtimeout=130</span><br><span class=\"line\">    dpdaction=clear</span><br><span class=\"line\">    sha2-truncbug=yes</span><br><span class=\"line\">    rightnexthop=%defaultroute</span><br><span class=\"line\">    forceencaps=yes</span><br><span class=\"line\">[root@host xl2tpd]# </span><br></pre></td></tr></table></figure>","text":"使用他的一键脚本 https://teddysun.com/448.html/comment-page-6#comments 如果你要想对用户进行操作，可以使用...","permalink":"/post/L2TP 一键安装","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"L2TP","slug":"L2TP","count":1,"path":"api/categories/L2TP.json"}],"tags":[{"name":"L2TP","slug":"L2TP","count":1,"path":"api/tags/L2TP.json"}],"toc":"","author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"cmake 升级到cmake-3.9.2版本","uid":"e540997bda9599822ca628bcc4397326","slug":"cmake 升级到cmake-3.9.2版本","date":"2019-07-29T05:24:48.000Z","updated":"2025-04-30T08:11:18.900Z","comments":true,"path":"api/articles/cmake 升级到cmake-3.9.2版本.json","keywords":null,"cover":null,"text":"一. 查看当前版本 cmake -version 12[root@host ~]# cmake -versioncmake version 2.8.12.2 二...","permalink":"/post/cmake 升级到cmake-3.9.2版本","photos":[],"count_time":{"symbolsCount":841,"symbolsTime":"1 mins."},"categories":[{"name":"cmake","slug":"cmake","count":1,"path":"api/categories/cmake.json"}],"tags":[{"name":"升级","slug":"升级","count":4,"path":"api/tags/升级.json"},{"name":"cmake","slug":"cmake","count":1,"path":"api/tags/cmake.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"firewall 防火墙常用命令","uid":"36fe1cc5933b149cb221b036d350eb16","slug":"firewall 防火墙常用命令","date":"2019-07-26T05:29:59.000Z","updated":"2025-04-30T08:11:18.900Z","comments":true,"path":"api/articles/firewall 防火墙常用命令.json","keywords":null,"cover":null,"text":"安装 firewalldyum install firewalld firewall-config 你也可以关闭目前还不熟悉的FirewallD防火墙，而使用i...","permalink":"/post/firewall 防火墙常用命令","photos":[],"count_time":{"symbolsCount":961,"symbolsTime":"1 mins."},"categories":[{"name":"firewall","slug":"firewall","count":1,"path":"api/categories/firewall.json"}],"tags":[{"name":"常用命令","slug":"常用命令","count":10,"path":"api/tags/常用命令.json"},{"name":"firewall","slug":"firewall","count":1,"path":"api/tags/firewall.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}