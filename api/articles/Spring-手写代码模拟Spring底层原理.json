{"title":"手写代码模拟Spring底层原理","uid":"e25e60e08cca60aa35b3d88aee490c5b","slug":"Spring-手写代码模拟Spring底层原理","date":"2022-12-08T07:06:03.000Z","updated":"2025-04-30T08:11:18.864Z","comments":true,"path":"api/articles/Spring-手写代码模拟Spring底层原理.json","keywords":null,"cover":null,"content":"<p>通过 <code>Spring</code> 核心原理解析已经大致了解了 <code>Bean</code> 的创建过程, 今天来尝试手写实现一下.</p>\n<h1 id=\"实现目标\"><a href=\"#实现目标\" class=\"headerlink\" title=\"实现目标\"></a>实现目标</h1><ol>\n<li>可以通过注解注入 <code>Bean</code></li>\n<li>实现通过容器的 <code>getBean</code> 方法获取 <code>Bean</code> 实例</li>\n<li>单例和多例 <code>bean</code> 的实现</li>\n<li><code>CGLIB动态代理Bean</code> 的实现</li>\n</ol>\n<h1 id=\"创建基本的类和注解\"><a href=\"#创建基本的类和注解\" class=\"headerlink\" title=\"创建基本的类和注解\"></a>创建基本的类和注解</h1><ol>\n<li><p>在 <code>com.spring</code> 包下分别创建 <code>WbAnnotationConfigApplicationContent</code>, <code>@ComponentSacn</code>,  <code>@Component</code>, <code>@Autowired</code> 注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.spring;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wb</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WbAnnotationSpringApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">WbAnnotationSpringApplication</span><span class=\"params\">(Class clazz)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object <span class=\"title function_\">getBean</span><span class=\"params\">(String beanName)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.spring;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wb</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> ComponentScan &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    String <span class=\"title function_\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.spring;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Component &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    String <span class=\"title function_\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.spring;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Autowired &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    String <span class=\"title function_\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>con.wb</code> 下创建我们自己代码 <code>AppConfig</code> ,<code>UserInfoService</code> , <code>OrderInfoService</code>, <code>WbTest</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.wb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.spring.WbAnnotationSpringApplication;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wb</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WbTest</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">WbAnnotationSpringApplication</span> <span class=\"variable\">context</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WbAnnotationSpringApplication</span>(AppConfig.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">UserInfoService</span> <span class=\"variable\">userInfoService</span> <span class=\"operator\">=</span> (UserInfoService) context.getBean(<span class=\"string\">&quot;userInfoService&quot;</span>);</span><br><span class=\"line\">        userInfoService.test();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.wb.service;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserInfoService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> OrderInfoService orderInfoService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(orderInfoService);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.wb.service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OrderInfoService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.wb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wb</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>项目初始化完毕.</p>\n<h1 id=\"分析-Spring-中的-AnnotationSpringApplication-做了什么\"><a href=\"#分析-Spring-中的-AnnotationSpringApplication-做了什么\" class=\"headerlink\" title=\"分析 Spring 中的 AnnotationSpringApplication 做了什么?\"></a>分析 <code>Spring</code> 中的 <code>AnnotationSpringApplication</code> 做了什么?</h1><ol>\n<li>通过 <code>AppConfig</code> 类上的 <code>@ComponentScan</code> 注解扫描其 <code>value</code> 值中的包.</li>\n<li>将扫描包中包含 <code>@Component</code> 注解的类通过一定的方法注入到 <code>Spring</code> 容器中.</li>\n</ol>\n<p>… 待更新</p>\n","text":"通过 Spring 核心原理解析已经大致了解了 Bean 的创建过程, 今天来尝试手写实现一下. 实现目标 可以通过注解注入 Bean 实现通过容器的 getB...","permalink":"/post/Spring-手写代码模拟Spring底层原理","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"Spring","slug":"Spring","count":7,"path":"api/categories/Spring.json"}],"tags":[{"name":"Spring","slug":"Spring","count":8,"path":"api/tags/Spring.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E7%8E%B0%E7%9B%AE%E6%A0%87\"><span class=\"toc-text\">实现目标</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC%E7%9A%84%E7%B1%BB%E5%92%8C%E6%B3%A8%E8%A7%A3\"><span class=\"toc-text\">创建基本的类和注解</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%88%86%E6%9E%90-Spring-%E4%B8%AD%E7%9A%84-AnnotationSpringApplication-%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88\"><span class=\"toc-text\">分析 Spring 中的 AnnotationSpringApplication 做了什么?</span></a></li></ol>","author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"xx视频APP API破解","uid":"d4fe6d958a1faa6764824e752c175fad","slug":"XX视频API破解","date":"2022-12-22T10:51:51.000Z","updated":"2025-04-30T08:11:18.866Z","comments":true,"path":"api/articles/XX视频API破解.json","keywords":null,"cover":[],"text":" xx视频是一个在线观看视频的APP, 速度非常快, 清晰度也够看, 就是有点瑟瑟的广告, 今天闲着没事我瞅瞅他的api, 看能不能白嫖一波. Android ...","permalink":"/post/XX视频API破解","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"反编译","slug":"反编译","count":1,"path":"api/categories/反编译.json"}],"tags":[{"name":"Android","slug":"Android","count":3,"path":"api/tags/Android.json"},{"name":"破解","slug":"破解","count":1,"path":"api/tags/破解.json"},{"name":"API","slug":"API","count":2,"path":"api/tags/API.json"},{"name":"视频","slug":"视频","count":1,"path":"api/tags/视频.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Flutter 开发技巧.md","uid":"d1e43acd29f91190a292b5c07c6764f5","slug":"Flutter 开发技巧","date":"2022-11-24T03:37:28.000Z","updated":"2025-04-30T08:11:18.840Z","comments":true,"path":"api/articles/Flutter 开发技巧.json","keywords":null,"cover":null,"text":"文档 Flutter Getx Doc API Doc 开源项目:flutter_bolg_manage 《Flutter实战·第二版》 沉浸式状态栏在main...","permalink":"/post/Flutter 开发技巧","photos":[],"count_time":{"symbolsCount":707,"symbolsTime":"1 mins."},"categories":[{"name":"Flutter","slug":"Flutter","count":4,"path":"api/categories/Flutter.json"}],"tags":[{"name":"经验","slug":"经验","count":7,"path":"api/tags/经验.json"},{"name":"Flutter","slug":"Flutter","count":4,"path":"api/tags/Flutter.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}