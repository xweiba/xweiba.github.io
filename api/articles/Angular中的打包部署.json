{"title":"Angular中的打包部署","uid":"d4364c984cc79dd6b4a34500dd5c7bd3","slug":"Angular中的打包部署","date":"2020-11-23T05:55:58.000Z","updated":"2025-04-30T08:11:18.830Z","comments":true,"path":"api/articles/Angular中的打包部署.json","keywords":null,"cover":null,"content":"<h2 id=\"13-Angular中的打包部署\"><a href=\"#13-Angular中的打包部署\" class=\"headerlink\" title=\"13.Angular中的打包部署\"></a><center>13.Angular中的打包部署</center></h2><h4 id=\"1-打包指令\"><a href=\"#1-打包指令\" class=\"headerlink\" title=\"1.打包指令\"></a>1.打包指令</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ng build --base-href xx --prod</span><br><span class=\"line\"></span><br><span class=\"line\">--base-href:指定在生成和识别URL时应保留的URL前缀。</span><br><span class=\"line\"></span><br><span class=\"line\">--prod: 指定生产模式,会压缩文件并去掉代码中的console</span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"2-实例\"><a href=\"#2-实例\" class=\"headerlink\" title=\"2.实例\"></a>2.实例</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   # /lv/ 是nginx中监听的path</span><br><span class=\"line\">- 打包,并指定前缀</span><br><span class=\"line\">ng build --base-href /lv/  --aot --prod</span><br><span class=\"line\"></span><br><span class=\"line\">   - nginx中配置 location需要与ng打包的前缀一致</span><br><span class=\"line\">location ^~ /lv &#123;</span><br><span class=\"line\">\talias   D:/IdeaProject/ETS-Cloud_LiveService/front/live-manager/dist/live-manager; # 这是angular生成的dist文件夹存放的位置</span><br><span class=\"line\">\tindex  index.html index.htm;</span><br><span class=\"line\">\ttry_files $uri $uri/ /index.html =404; # 注意此句，一定要加上。否则配置的子路由等无法使用</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 配置webSocket连接</span><br><span class=\"line\">   location ^~ /live/websocket &#123;</span><br><span class=\"line\">       proxy_pass http://live-microservice;</span><br><span class=\"line\">       proxy_set_header Host $host;</span><br><span class=\"line\">       proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">       client_max_body_size 1000m;</span><br><span class=\"line\">       proxy_set_header Upgrade $http_upgrade;  #ws配置</span><br><span class=\"line\">       proxy_set_header Connection &quot;upgrade&quot;;   #ws配置</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3-angular中编码方式获取APP-BASE-HREF\"><a href=\"#3-angular中编码方式获取APP-BASE-HREF\" class=\"headerlink\" title=\"3.angular中编码方式获取APP-BASE-HREF\"></a>3.angular中编码方式获取APP-BASE-HREF</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1.第一种方式,通过index.html中的<base href=\"\" />的值,来动态获取</p></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * This function is used internal to get a string instance of the `&lt;base href=&quot;&quot; /&gt;` value from `index.html`.</span><br><span class=\"line\"> * This is an exported function, instead of a private function or inline lambda, to prevent this error:</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * `Error encountered resolving symbol values statically.`</span><br><span class=\"line\"> * `Function calls are not supported.`</span><br><span class=\"line\"> * `Consider replacing the function or lambda with a reference to an exported function.`</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * @param platformLocation an Angular service used to interact with a browser&#x27;s URL</span><br><span class=\"line\"> * @return a string instance of the `&lt;base href=&quot;&quot; /&gt;` value from `index.html`</span><br><span class=\"line\"> */</span><br><span class=\"line\">export function getBaseHref(platformLocation: PlatformLocation): string &#123;</span><br><span class=\"line\">    return platformLocation.getBaseHrefFromDOM();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@NgModule(&#123;</span><br><span class=\"line\">    declarations: [</span><br><span class=\"line\">        AppComponent</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    providers: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            provide: APP_BASE_HREF,</span><br><span class=\"line\">            useFactory: getBaseHref,</span><br><span class=\"line\">            deps: [PlatformLocation]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    bootstrap: [</span><br><span class=\"line\">        AppComponent</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">export class AppModule &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">constructor(@Inject(APP_BASE_HREF) private baseHref: string) &#123;</span><br><span class=\"line\">    console.log(`APP_BASE_HREF is $&#123;this.baseHref&#125;`);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><ol start=\"2\">\n<li>通过指定LocationStrategy,通过Angular中LocationStrategy.getBaseHref()来获取</li>\n</ol></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">import &#123; LocationStrategy, PathLocationStrategy &#125; from &#x27;@angular/common&#x27;;</span><br><span class=\"line\">...</span><br><span class=\"line\">@NgModule(&#123;</span><br><span class=\"line\">  providers: [</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    &#123;provide: LocationStrategy, useClass: PathLocationStrategy&#125;,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">export class AppModule &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">constructor(private locationStrategy: LocationStrategy, ...) &#123;</span><br><span class=\"line\">  console.log(this.locationStrategy.getBaseHref());</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"4-集成https\"><a href=\"#4-集成https\" class=\"headerlink\" title=\"4.集成https\"></a>4.集成https</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   server &#123;</span><br><span class=\"line\">\tlisten 8886 ssl;</span><br><span class=\"line\">       server_name  xxx.com;</span><br><span class=\"line\">       index index.html index.php;</span><br><span class=\"line\"></span><br><span class=\"line\">       ssl_certificate      /etc/ssl/hwlive/4464505_hwlive.enable-ets.com.pem;</span><br><span class=\"line\">       ssl_certificate_key  /etc/ssl/hwlive/4464505_hwlive.enable-ets.com.key;</span><br><span class=\"line\"></span><br><span class=\"line\">       ssl_session_cache    shared:SSL:1m;</span><br><span class=\"line\">       ssl_session_timeout  5m;</span><br><span class=\"line\"></span><br><span class=\"line\">       ssl_ciphers  ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class=\"line\">       ssl_prefer_server_ciphers  on;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tlocation ^~ /live/websocket &#123;</span><br><span class=\"line\">        proxy_pass http://live-microservice;</span><br><span class=\"line\">           proxy_set_header Host $host;</span><br><span class=\"line\">           proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">           client_max_body_size 1000m;</span><br><span class=\"line\">           proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">\t\tproxy_set_header Connection &quot;upgrade&quot;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t </span><br><span class=\"line\">\t </span><br><span class=\"line\">    location /lv &#123;</span><br><span class=\"line\">           alias /home/icampus3.0/pkgs/live-microservice/dist/live-manager;</span><br><span class=\"line\">   \t\tindex index.html index.htm;</span><br><span class=\"line\">   \t\ttry_files $uri $uri/ /index.html =404; </span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","text":"13.Angular中的打包部署1.打包指令12345ng build --base-href xx --prod--base-href:指定在生成和识别URL...","permalink":"/post/Angular中的打包部署","photos":[],"count_time":{"symbolsCount":"3.8k","symbolsTime":"3 mins."},"categories":[{"name":"Angular","slug":"Angular","count":16,"path":"api/categories/Angular.json"}],"tags":[{"name":"Angular","slug":"Angular","count":16,"path":"api/tags/Angular.json"},{"name":"打包","slug":"打包","count":1,"path":"api/tags/打包.json"},{"name":"部署","slug":"部署","count":1,"path":"api/tags/部署.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#13-Angular%E4%B8%AD%E7%9A%84%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2\"><span class=\"toc-text\">13.Angular中的打包部署</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-%E6%89%93%E5%8C%85%E6%8C%87%E4%BB%A4\"><span class=\"toc-text\">1.打包指令</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-%E5%AE%9E%E4%BE%8B\"><span class=\"toc-text\">2.实例</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-angular%E4%B8%AD%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F%E8%8E%B7%E5%8F%96APP-BASE-HREF\"><span class=\"toc-text\">3.angular中编码方式获取APP-BASE-HREF</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-%E9%9B%86%E6%88%90https\"><span class=\"toc-text\">4.集成https</span></a></li></ol></li></ol></li></ol>","author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Angular中的指令","uid":"eaf20d8c0e78dfcdaa662d58c5894839","slug":"Angular中的指令","date":"2020-11-23T05:56:50.000Z","updated":"2025-04-30T08:11:18.830Z","comments":true,"path":"api/articles/Angular中的指令.json","keywords":null,"cover":null,"text":"14.Angular中的指令1. 指令类型 Angular 中有三种类型的指令 组件 — 拥有模板的指令 结构型指令 — 通过添加和移除 DOM 元素改变 DO...","permalink":"/post/Angular中的指令","photos":[],"count_time":{"symbolsCount":"3.1k","symbolsTime":"3 mins."},"categories":[{"name":"Angular","slug":"Angular","count":16,"path":"api/categories/Angular.json"}],"tags":[{"name":"Angular","slug":"Angular","count":16,"path":"api/tags/Angular.json"},{"name":"指令","slug":"指令","count":1,"path":"api/tags/指令.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Angular中的路由守卫(Guard)","uid":"c54bc56e9a6984ec854ec855b661e852","slug":"Angular中的路由守卫(Guard)","date":"2020-11-23T05:55:16.000Z","updated":"2025-04-30T08:11:18.831Z","comments":true,"path":"api/articles/Angular中的路由守卫(Guard).json","keywords":null,"cover":null,"text":"11.路由守卫-Guard1.Guard123456有四种类型: 1.canActivate: 控制是否允许进入路由 2.canActivateChild: 等...","permalink":"/post/Angular中的路由守卫(Guard)","photos":[],"count_time":{"symbolsCount":628,"symbolsTime":"1 mins."},"categories":[{"name":"Angular","slug":"Angular","count":16,"path":"api/categories/Angular.json"}],"tags":[{"name":"Angular","slug":"Angular","count":16,"path":"api/tags/Angular.json"},{"name":"Guard","slug":"Guard","count":1,"path":"api/tags/Guard.json"},{"name":"路由守卫","slug":"路由守卫","count":1,"path":"api/tags/路由守卫.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}