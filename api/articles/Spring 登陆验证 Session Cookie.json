{"title":"Spring 登陆验证 Session Cookie","uid":"6e888c70e455b1bb951534046563934e","slug":"Spring 登陆验证 Session Cookie","date":"2018-05-21T04:40:33.000Z","updated":"2025-04-30T08:11:18.863Z","comments":true,"path":"api/articles/Spring 登陆验证 Session Cookie.json","keywords":null,"cover":[],"content":"<h2 id=\"今日完成的事\"><a href=\"#今日完成的事\" class=\"headerlink\" title=\"今日完成的事\"></a>今日完成的事</h2><ul>\n<li>线上项目 整合Cookie 登陆</li>\n<li>通过 Memcached 来同步Session, 解决tomcat多开带来的Session同步问题.</li>\n</ul>\n<h2 id=\"Memcached-同步-Session\"><a href=\"#Memcached-同步-Session\" class=\"headerlink\" title=\"Memcached 同步 Session\"></a>Memcached 同步 Session</h2><ol>\n<li><p>由于使用了多台tomcat, 在Nginx做负载均衡时会将请求随机分发到各个tomcat上, 当属于tomcat_1的登陆后会话请求被转发到tomcat_2上时, 就会出现登陆验证错误, 因为tomcat_2上这个会话并未登陆.</p>\n</li>\n<li><p>解决方法, 通过Memcache保存Session会话.</p>\n<ul>\n<li>注意, Session是容器保存的,内容放置在服务器具体的文件中,并不是程序保存的, 这个概念一定要搞清楚.</li>\n<li>我这里场景是 登陆后执行一个请求列出所有用户, 所以不能直接转到jsp. </li>\n<li>使用 <code>redirect</code> 跳转页面会导致 session 值丢失. <a href=\"https://blog.csdn.net/qshpeng/article/details/51506729\">参考连接1</a> <a href=\"https://blog.csdn.net/zhanghongzheng3213/article/details/52415839\">参考连接2</a></li>\n<li>解决方法<ol>\n<li>思路: handler中保存session后,先forward到一个handler再redirect到目标handler, session值不会丢失</li>\n<li>具体实现:<ul>\n<li>handler 中保存 session, 此时session还未保存到容器中<ul>\n<li>返回页面使用redirect到新页面,因为重定向特性不会带前页面的数据, 所以容器会将session值直接丢弃,导致session值丢失.(session id还在)</li>\n<li>返回时使用 forward 到新handler, 容器会将session保存.</li>\n</ul>\n</li>\n<li>在新handler中再redirect到新页面, 此时session已保存,不会影响</li>\n</ul>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"将Tomcat的session由Memcached保存-准备工作\"><a href=\"#将Tomcat的session由Memcached保存-准备工作\" class=\"headerlink\" title=\"将Tomcat的session由Memcached保存  准备工作\"></a>将Tomcat的session由Memcached保存  准备工作</h3><ul>\n<li>Nginx 负载均衡已配置</li>\n<li>Tomcat 已开启多个容器</li>\n<li>Tomcat 8</li>\n<li>官方文档: <code>https://github.com/magro/memcached-session-manager/wiki/SetupAndConfiguration</code></li>\n<li>参考资料: <code>https://www.cnblogs.com/jsonhc/p/7344902.html</code></li>\n<li></li>\n</ul>\n<h3 id=\"下载所需jar包-每个tomcat版本对应的包不同\"><a href=\"#下载所需jar包-每个tomcat版本对应的包不同\" class=\"headerlink\" title=\"下载所需jar包, 每个tomcat版本对应的包不同\"></a>下载所需jar包, 每个tomcat版本对应的包不同</h3><ul>\n<li><code>wget http://repo1.maven.org/maven2/de/javakaffee/msm/memcached-session-manager/2.1.1/memcached-session-manager-2.1.1.jar</code></li>\n<li><code>wget http://repo1.maven.org/maven2/de/javakaffee/msm/memcached-session-manager-tc8/2.1.1/memcached-session-manager-tc8-2.1.1.jar</code></li>\n<li><code>wget http://repo1.maven.org/maven2/net/spy/spymemcached/2.11.1/spymemcached-2.11.1.jar</code></li>\n<li>如果仅仅只是用java来做序列化器只需上面这三个包就ok</li>\n<li>下面两个包,配置后一直报错,未测试通过 </li>\n<li><code>wget http://repo1.maven.org/maven2/de/javakaffee/msm/msm-javolution-serializer/1.8.3/msm-javolution-serializer-1.8.3.jar</code></li>\n<li><code>wget http://repo1.maven.org/maven2/de/javakaffee/msm/msm-javolution-serializer/2.1.1/msm-javolution-serializer-2.1.1.jar</code></li>\n<li>下载完成后放入tomcat&#x2F;lib目录中</li>\n</ul>\n<h3 id=\"修改两个tomcat配置文件-启动\"><a href=\"#修改两个tomcat配置文件-启动\" class=\"headerlink\" title=\"修改两个tomcat配置文件,启动\"></a>修改两个tomcat配置文件,启动</h3><ul>\n<li><p>vim <code>&#123;tomcat&#125;/conf/context.xml</code></p>\n  <figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Context&gt;</span><br><span class=\"line\">    &lt;!-- web application will be reloaded.                                   --&gt;</span><br><span class=\"line\">    &lt;WatchedResource&gt;WEB-INF/web.xml&lt;/WatchedResource&gt;</span><br><span class=\"line\">    &lt;WatchedResource&gt;<span class=\"variable\">$&#123;catalina.base&#125;</span>/conf/web.xml&lt;/WatchedResource&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Uncomment this to <span class=\"built_in\">disable</span> session persistence across Tomcat restarts --&gt;</span><br><span class=\"line\">    &lt;!--</span><br><span class=\"line\">    &lt;Manager pathname=<span class=\"string\">&quot;&quot;</span> /&gt;</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">    &lt;Manager className=<span class=\"string\">&quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&quot;</span></span><br><span class=\"line\">    memcachedNodes=<span class=\"string\">&quot;n1:127.0.0.1:11211,n2:127.0.0.1:22122&quot;</span></span><br><span class=\"line\">    failoverNodes=<span class=\"string\">&quot;n1&quot;</span></span><br><span class=\"line\">    requestUriIgnorePattern=<span class=\"string\">&quot;.*\\.(ico|png|gif|jpg|css|js)$&quot;</span></span><br><span class=\"line\">    /&gt;</span><br><span class=\"line\">&lt;/Context&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"开一个test项目测试\"><a href=\"#开一个test项目测试\" class=\"headerlink\" title=\"开一个test项目测试\"></a>开一个test项目测试</h3><ul>\n<li>test&#x2F;index.jsp, 分别写到两个 tomcat 测试, 修改{TomcatA}.liuhuan.ml代指Tomcat容器<figure class=\"highlight jsp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%@ page language=<span class=\"string\">&quot;java&quot;</span> %&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;&lt;title&gt;TomcatA&lt;/title&gt;&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;h1&gt;&lt;font color=<span class=\"string\">&quot;blue&quot;</span>&gt;TomcatA.liuhuan.ml&lt;/font&gt;&lt;/h1&gt;</span><br><span class=\"line\">&lt;table align=<span class=\"string\">&quot;centre&quot;</span> border=<span class=\"string\">&quot;1&quot;</span>&gt;</span><br><span class=\"line\">&lt;tr&gt;</span><br><span class=\"line\">    &lt;td&gt;SessionID&lt;/td&gt;</span><br><span class=\"line\">    &lt;%session.setAttribute(<span class=\"string\">&quot;linuxinfo.top&quot;</span>,<span class=\"string\">&quot;linuxinfo.top&quot;</span>);%&gt;</span><br><span class=\"line\">    &lt;td&gt;&lt;%=session.getId() %&gt;&lt;/td&gt;</span><br><span class=\"line\">&lt;/tr&gt;</span><br><span class=\"line\">&lt;tr&gt;</span><br><span class=\"line\">    &lt;td&gt;Createdon&lt;/td&gt;</span><br><span class=\"line\">    &lt;td&gt;&lt;%=session.getCreationTime() %&gt;&lt;/td&gt;</span><br><span class=\"line\">&lt;/tr&gt;</span><br><span class=\"line\">&lt;/table&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><img src=\"/post/Spring%20%E7%99%BB%E9%99%86%E9%AA%8C%E8%AF%81%20Session%20Cookie/2cffeaf1-9949-484a-bacf-8cdfff596573.png\" class=\"\" title=\"image\">\n<img src=\"/post/Spring%20%E7%99%BB%E9%99%86%E9%AA%8C%E8%AF%81%20Session%20Cookie/e7e5416a-0c0e-4d54-ba61-071d7d8c0c55.png\" class=\"\" title=\"image\">\n\n<h3 id=\"启动Memcached\"><a href=\"#启动Memcached\" class=\"headerlink\" title=\"启动Memcached\"></a>启动Memcached</h3><ul>\n<li><code>memcached -p 11211 -m 64m -vv -u root</code></li>\n<li><code>memcached -p 22122 -m 64m -vv -u root</code></li>\n</ul>\n<h3 id=\"测试-1\"><a href=\"#测试-1\" class=\"headerlink\" title=\"测试\"></a>测试</h3><figure class=\"highlight jsp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%@ page language=<span class=\"string\">&quot;java&quot;</span> %&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;&lt;title&gt;TomcatA&lt;/title&gt;&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">   &lt;h1&gt;&lt;font color=<span class=\"string\">&quot;blue&quot;</span>&gt;TomcatA.liuhuan.ml&lt;/font&gt;&lt;/h1&gt;</span><br><span class=\"line\">   &lt;table align=<span class=\"string\">&quot;centre&quot;</span> border=<span class=\"string\">&quot;1&quot;</span>&gt;</span><br><span class=\"line\">       &lt;tr&gt;</span><br><span class=\"line\">           &lt;td&gt;SessionID&lt;/td&gt;</span><br><span class=\"line\">           &lt;%session.setAttribute(<span class=\"string\">&quot;linuxinfo.top&quot;</span>,<span class=\"string\">&quot;linuxinfo.top&quot;</span>);%&gt;</span><br><span class=\"line\">&lt;td&gt;&lt;%=session.getId() %&gt;&lt;/td&gt;</span><br><span class=\"line\">       &lt;/tr&gt;</span><br><span class=\"line\">       &lt;tr&gt;</span><br><span class=\"line\">           &lt;td&gt;Createdon&lt;/td&gt;</span><br><span class=\"line\">           &lt;td&gt;&lt;%=session.getCreationTime() %&gt;&lt;/td&gt;</span><br><span class=\"line\">       &lt;/tr&gt;</span><br><span class=\"line\">   &lt;/table&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"实际项目\"><a href=\"#实际项目\" class=\"headerlink\" title=\"实际项目\"></a>实际项目</h3><ol>\n<li>session 登陆验证 <code>Controller</code> <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//登陆</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/login.action&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> String <span class=\"title function_\">login</span><span class=\"params\">(HttpSession session, Auth auth)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(userService.findAuth(auth))&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 在session中保存用户身份信息</span></span><br><span class=\"line\">        session.setAttribute(<span class=\"string\">&quot;username&quot;</span>, auth.getUsername());</span><br><span class=\"line\">        logger.info(<span class=\"string\">&quot;session.getId():&quot;</span> + session.getId());</span><br><span class=\"line\">        <span class=\"comment\">// 存入缓存 用作效验</span></span><br><span class=\"line\">        MemcacheUtils.set(session.getId(), auth.getUsername());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//redirect 重定向到用户信息页面,会导致session内容丢失. 这里先forward保存session</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;forward:/s/succed.action&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//退出登陆</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/logout.action&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> String <span class=\"title function_\">logout</span><span class=\"params\">(HttpSession session)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 删除缓存</span></span><br><span class=\"line\">    MemcacheUtils.delete(session.getId());</span><br><span class=\"line\">    <span class=\"comment\">//删除session</span></span><br><span class=\"line\">    session.invalidate();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;redirect:/login.action&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>拦截器效验 <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//执行Handler方法之前执行</span><br><span class=\"line\">//用于身份认证、身份授权</span><br><span class=\"line\">//比如身份认证，如果认证通过表示当前用户没有登陆，需要此方法拦截不再向下执行</span><br><span class=\"line\">@Override</span><br><span class=\"line\">public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) throws Exception &#123;</span><br><span class=\"line\">    //handler 开始时间</span><br><span class=\"line\">    this.timer = System.currentTimeMillis();</span><br><span class=\"line\">    //获取请求的url</span><br><span class=\"line\">    String url = httpServletRequest.getRequestURI();</span><br><span class=\"line\">    //判断url是否是公开地址(实际使用时将公开地址配置到配置文件中)</span><br><span class=\"line\"></span><br><span class=\"line\">    //正则匹配url</span><br><span class=\"line\">    Pattern pattern = Pattern.compile(&quot;^.*login.action.*$|^.*rest\\\\/api\\\\/.*$|^.*home\\\\/.*$|^.*profession\\\\/.*$|^.*memcache\\\\/.*$&quot;);</span><br><span class=\"line\">    Matcher matcher = pattern.matcher(url);</span><br><span class=\"line\"></span><br><span class=\"line\">    //可以导入一个配置文件,匹配其中的请求</span><br><span class=\"line\">    if (matcher.matches())&#123;</span><br><span class=\"line\">        //如果要进行登陆提交,放行</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    // 获取 session</span><br><span class=\"line\">    HttpSession session = httpServletRequest.getSession();</span><br><span class=\"line\">    // 从session中取出用户信息</span><br><span class=\"line\">    String username = (String)session.getAttribute(&quot;username&quot;);</span><br><span class=\"line\">    logger.debug(&quot;尝试登陆用户: &quot; + username + &quot;session_id:&quot; + session.getId());</span><br><span class=\"line\"></span><br><span class=\"line\">    // 登陆数据效验</span><br><span class=\"line\">    if(username !=&quot;&quot; &amp;&amp;username!=null)&#123;</span><br><span class=\"line\">        String sessionName = (String) MemcacheUtils.get(session.getId());</span><br><span class=\"line\">        logger.info(&quot;登陆用户名: &quot; + username +  &quot;, sessionName:&quot; + sessionName + &quot;, session.getId():&quot; + session.getId());</span><br><span class=\"line\">        if(username.equals(sessionName))&#123;</span><br><span class=\"line\">            //身份存在 放行</span><br><span class=\"line\">            logger.debug(&quot;身份存在 放行&quot;);</span><br><span class=\"line\">            return true;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        // 当 session或缓存的 username 的 值为空时(可能是缓存出问题,又或者浏览器将seesion删除), 需要删除其session重新创建, 否则会一直判空</span><br><span class=\"line\">        // 删除缓存</span><br><span class=\"line\">        MemcacheUtils.delete(session.getId());</span><br><span class=\"line\">        //删除session</span><br><span class=\"line\">        session.invalidate();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    //执行到这里标识用户身份需要认证,跳转到登陆界面</span><br><span class=\"line\">    //跳转网址需要绝对路径,将当前请求重新映射到/WEB-INF/jsp/login.jsp,</span><br><span class=\"line\">    // WEB-INF/jsp/login.jsp访问的是原地址+WEB-INF/jsp/login.jsp</span><br><span class=\"line\">    httpServletRequest.getRequestDispatcher(&quot;/WEB-INF/jsp/login.jsp&quot;).forward(httpServletRequest, httpServletResponse);</span><br><span class=\"line\">    logger.info(&quot;用户身份需要认证,跳转至登陆页面,执行Handler方法之前执行&quot;);</span><br><span class=\"line\">    //return false表示拦截，不向下执行 此时应计算页面结束时间</span><br><span class=\"line\">    this.timer = System.currentTimeMillis() - this.timer;</span><br><span class=\"line\">    logger.debug( &quot;性能日志 页面生成时长 : &quot; + this.timer + &quot;ms&quot; );</span><br><span class=\"line\">    //return true表示放行</span><br><span class=\"line\">    return false;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"登陆测试\"><a href=\"#登陆测试\" class=\"headerlink\" title=\"登陆测试\"></a>登陆测试</h3><ol>\n<li>session 登陆测试<img src=\"/post/Spring%20%E7%99%BB%E9%99%86%E9%AA%8C%E8%AF%81%20Session%20Cookie/59f903cf-1628-4ee9-ba9a-45177a98551a.png\" class=\"\" title=\"image\">\n<img src=\"/post/Spring%20%E7%99%BB%E9%99%86%E9%AA%8C%E8%AF%81%20Session%20Cookie/9a0bcebe-2251-42e2-9e74-d5c075af201f.png\" class=\"\" title=\"image\">\n<ul>\n<li>日志<br><img src=\"https://note.youdao.com/yws/public/resource/57891bc9ca8b961d3711858d81d17913/xmlnote/BF7C9D39EDE5456D97BB7342746DFE3A/1624\" alt=\"image\"><br><img src=\"https://note.youdao.com/yws/public/resource/57891bc9ca8b961d3711858d81d17913/xmlnote/DA25E0FEE5364BBAA18A806C438C51B3/1626\" alt=\"image\"></li>\n<li>重启tomcat, session任然可以登陆<br><img src=\"https://note.youdao.com/yws/public/resource/57891bc9ca8b961d3711858d81d17913/xmlnote/2557DD4864C34F599F636FEE686300AD/1635\" alt=\"image\"></li>\n<li>刷新页面 正常显示<br><img src=\"https://note.youdao.com/yws/public/resource/57891bc9ca8b961d3711858d81d17913/xmlnote/1FFEB2DE5D464021AFEF6545B4247314/1640\" alt=\"image\"></li>\n<li>日志<br><img src=\"https://note.youdao.com/yws/public/resource/57891bc9ca8b961d3711858d81d17913/xmlnote/363EC85C74D140ADB25D7890A8104CE0/1644\" alt=\"image\"></li>\n</ul>\n</li>\n</ol>\n<ul>\n<li>Cookie登陆, 由于它存储在用户端, 后端只需要解密验证, 没有同步问题, 服务器端重启也是不影响它验证的<br><img src=\"https://note.youdao.com/yws/public/resource/57891bc9ca8b961d3711858d81d17913/xmlnote/0F8AD413B7C74644ACA028A75D8BAD03/1663\" alt=\"image\"><br><img src=\"https://note.youdao.com/yws/public/resource/57891bc9ca8b961d3711858d81d17913/xmlnote/D70D564D5F754C06B2CC87C9C06F1850/1665\" alt=\"image\"></li>\n</ul>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li>memcached 因为session同步的问题拖了一天, 今天就结束了, 相对cookie验证, 纯session相对限制多一些.</li>\n</ul>\n<h2 id=\"明日计划\"><a href=\"#明日计划\" class=\"headerlink\" title=\"明日计划\"></a>明日计划</h2><ul>\n<li>更换Redis测试.</li>\n</ul>\n","text":"今日完成的事 线上项目 整合Cookie 登陆 通过 Memcached 来同步Session, 解决tomcat多开带来的Session同步问题. Memca...","permalink":"/post/Spring 登陆验证 Session Cookie","photos":[],"count_time":{"symbolsCount":"7.2k","symbolsTime":"7 mins."},"categories":[{"name":"Spring","slug":"Spring","count":7,"path":"api/categories/Spring.json"}],"tags":[{"name":"Spring","slug":"Spring","count":8,"path":"api/tags/Spring.json"},{"name":"Cookie","slug":"Cookie","count":1,"path":"api/tags/Cookie.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%8A%E6%97%A5%E5%AE%8C%E6%88%90%E7%9A%84%E4%BA%8B\"><span class=\"toc-text\">今日完成的事</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Memcached-%E5%90%8C%E6%AD%A5-Session\"><span class=\"toc-text\">Memcached 同步 Session</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%86Tomcat%E7%9A%84session%E7%94%B1Memcached%E4%BF%9D%E5%AD%98-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\"><span class=\"toc-text\">将Tomcat的session由Memcached保存  准备工作</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%8B%E8%BD%BD%E6%89%80%E9%9C%80jar%E5%8C%85-%E6%AF%8F%E4%B8%AAtomcat%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E7%9A%84%E5%8C%85%E4%B8%8D%E5%90%8C\"><span class=\"toc-text\">下载所需jar包, 每个tomcat版本对应的包不同</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9%E4%B8%A4%E4%B8%AAtomcat%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-%E5%90%AF%E5%8A%A8\"><span class=\"toc-text\">修改两个tomcat配置文件,启动</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%BC%80%E4%B8%80%E4%B8%AAtest%E9%A1%B9%E7%9B%AE%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">开一个test项目测试</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">测试</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8Memcached\"><span class=\"toc-text\">启动Memcached</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B5%8B%E8%AF%95-1\"><span class=\"toc-text\">测试</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE\"><span class=\"toc-text\">实际项目</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%99%BB%E9%99%86%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">登陆测试</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%98%8E%E6%97%A5%E8%AE%A1%E5%88%92\"><span class=\"toc-text\">明日计划</span></a></li></ol>","author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"JQuery 文件上传","uid":"a8ca03413c144f76afe39fcc28a8a039","slug":"JQuery 文件上传","date":"2018-05-23T05:02:42.000Z","updated":"2025-04-30T08:11:18.848Z","comments":true,"path":"api/articles/JQuery 文件上传.json","keywords":null,"cover":null,"text":"Java后端接收文件: 12345@RequestMapping(value = \"/uploaded\")@ResponseBodypublic String ...","permalink":"/post/JQuery 文件上传","photos":[],"count_time":{"symbolsCount":"4.6k","symbolsTime":"4 mins."},"categories":[{"name":"JQuery","slug":"JQuery","count":1,"path":"api/categories/JQuery.json"}],"tags":[{"name":"JQuery","slug":"JQuery","count":1,"path":"api/tags/JQuery.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"SpringMVC 整合 memcached","uid":"e5e16181cb838f43f9740a90072d7812","slug":"Spring MVC 整合memcached ","date":"2018-05-19T04:40:33.000Z","updated":"2025-04-30T08:11:18.863Z","comments":true,"path":"api/articles/Spring MVC 整合memcached .json","keywords":null,"cover":[],"text":"今天完成的事情 完成Spring MVC memcachede 融合 整合 memcachede只缓存数据, 所以我们只需要在service 层 的实现中添加对...","permalink":"/post/Spring MVC 整合memcached ","photos":[],"count_time":{"symbolsCount":"6k","symbolsTime":"5 mins."},"categories":[{"name":"SpringMVC","slug":"SpringMVC","count":1,"path":"api/categories/SpringMVC.json"}],"tags":[{"name":"SpringMVC","slug":"SpringMVC","count":1,"path":"api/tags/SpringMVC.json"},{"name":"memcached","slug":"memcached","count":1,"path":"api/tags/memcached.json"},{"name":"缓存","slug":"缓存","count":2,"path":"api/tags/缓存.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}