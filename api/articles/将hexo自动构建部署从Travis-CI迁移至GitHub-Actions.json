{"title":"hexo自动构建部署从Travis CI迁移至GitHub Actions","uid":"ad9e949c878a65f54af3e2722178fa5b","slug":"将hexo自动构建部署从Travis-CI迁移至GitHub-Actions","date":"2022-02-28T01:31:34.000Z","updated":"2025-04-30T08:11:18.900Z","comments":true,"path":"api/articles/将hexo自动构建部署从Travis-CI迁移至GitHub-Actions.json","keywords":null,"cover":[],"content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>很久没更新博客了，今天想更新一下发现构建失败，看了下是因为 <code>Travis CI</code> 开始商业化了，我的免费额度早就用完了，正好现在都在玩 <code>GitHub Actions</code>, 切换过来了.  使用的 <code>Workflow</code> 是基于 <a href=\"https://printempw.github.io/use-github-actions-to-deploy-hexo-blog/\">使用 GitHub Actions 自动部署 Hexo 博客</a> 的, 感谢大大.</p></blockquote>\n<p>仓库和 <code>Travis CI</code> 时一样，<code>master</code> 为部署分支，<code>source</code> 分支为博客构建分支，<code>blog</code> 都在这里面。</p>\n<h2 id=\"Hexo-添加-Git-部署依赖\"><a href=\"#Hexo-添加-Git-部署依赖\" class=\"headerlink\" title=\"Hexo 添加 Git 部署依赖\"></a>Hexo 添加 Git 部署依赖</h2><p>自动部署需要用到 <code>hexo-deployer-git</code> 依赖: <code>npm install -save hexo-deployer-git</code>.</p>\n<p>编辑 <code>hexo</code> 配置:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deploy:</span> </span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">git</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> <span class=\"string\">git@github.com:xweiba/xweiba.github.io.git</span></span><br><span class=\"line\">  <span class=\"attr\">branch:</span> <span class=\"string\">master</span> <span class=\"comment\"># 部署到的分支</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">xweiba</span></span><br><span class=\"line\">  <span class=\"attr\">email:</span> <span class=\"string\">xiaoweiba1028@gmail.com</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置部署密钥\"><a href=\"#配置部署密钥\" class=\"headerlink\" title=\"配置部署密钥\"></a>配置部署密钥</h2><p>终端执行 <code>ssh-keygen -t rsa -C &quot;xiaoweiba1028@gmail.com&quot; -f D:\\github\\xweiba\\hexo-deploy-key</code>, 即可生成 <code>id_rsa</code> 和 <code>id_rsa.pub</code> 文件。</p>\n<p>将公钥 <code>hexo-deploy-key.pub</code> 设置为仓库的部署密钥 <code>Settings &gt; Deploy keys</code>:</p>\n<img src=\"/post/%E5%B0%86hexo%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2%E4%BB%8ETravis-CI%E8%BF%81%E7%A7%BB%E8%87%B3GitHub-Actions/image-20220228095534107.png\" class=\"\" title=\"image-20220228095534107\">\n\n<p>然后在仓库的 <code>Settings &gt; Actions</code> 中新增一个 <code>secret</code>，命名为 <code>DEPLOY_KEY</code>，把私钥 <code>hexo-deploy-key</code> 的内容复制进去，供后续使用。</p>\n<img src=\"/post/%E5%B0%86hexo%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2%E4%BB%8ETravis-CI%E8%BF%81%E7%A7%BB%E8%87%B3GitHub-Actions/image-20220228095733027.png\" class=\"\" title=\"image-20220228095733027\">\n\n<h2 id=\"编写-Workflow\"><a href=\"#编写-Workflow\" class=\"headerlink\" title=\"编写 Workflow\"></a>编写 Workflow</h2><p><code>Workflow</code> 就是 <code>GitHub Actions</code> 的配置文件，类似于 <code>.travis.yml</code>。</p>\n<p>在 <code>source</code> 分支新建文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p .github/workflows</span><br><span class=\"line\"><span class=\"built_in\">touch</span> .github/workflows/deploy.yml</span><br></pre></td></tr></table></figure>\n\n<p>编辑 <code>deploy.yml</code>：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">Hexo</span> <span class=\"string\">Deploy</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 只监听 source 分支的改动</span></span><br><span class=\"line\"><span class=\"attr\">on:</span></span><br><span class=\"line\">  <span class=\"attr\">push:</span></span><br><span class=\"line\">    <span class=\"attr\">branches:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">source</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 自定义环境变量</span></span><br><span class=\"line\"><span class=\"attr\">env:</span></span><br><span class=\"line\">  <span class=\"attr\">POST_ASSET_IMAGE_CDN:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\">  <span class=\"attr\">build-and-deploy:</span></span><br><span class=\"line\">    <span class=\"attr\">runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">steps:</span></span><br><span class=\"line\">      <span class=\"comment\"># 获取博客源码和主题</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Checkout</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">actions/checkout@v2</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># 这里用的是 Node.js 14.x</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Set</span> <span class=\"string\">up</span> <span class=\"string\">Node.js</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">actions/setup-node@v1</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">node-version:</span> <span class=\"string\">&#x27;14&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># 设置 yarn 缓存，npm 的话可以看 actions/cache@v2 的文档示例</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Get</span> <span class=\"string\">yarn</span> <span class=\"string\">cache</span> <span class=\"string\">directory</span> <span class=\"string\">path</span></span><br><span class=\"line\">        <span class=\"attr\">id:</span> <span class=\"string\">yarn-cache-dir-path</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">echo</span> <span class=\"string\">&quot;::set-output name=dir::$(yarn cache dir)&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Use</span> <span class=\"string\">yarn</span> <span class=\"string\">cache</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">actions/cache@v2</span></span><br><span class=\"line\">        <span class=\"attr\">id:</span> <span class=\"string\">yarn-cache</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">steps.yarn-cache-dir-path.outputs.dir</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">runner.os</span> <span class=\"string\">&#125;&#125;-yarn-$&#123;&#123;</span> <span class=\"string\">hashFiles(&#x27;**/yarn.lock&#x27;)</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\">          <span class=\"attr\">restore-keys:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">            $&#123;&#123; runner.os &#125;&#125;-yarn-</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\">      <span class=\"comment\"># 安装依赖</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Install</span> <span class=\"string\">dependencies</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">          yarn install --prefer-offline --frozen-lockfile</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\">      <span class=\"comment\"># 从之前设置的 secret 获取部署私钥</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Set</span> <span class=\"string\">up</span> <span class=\"string\">environment</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">          <span class=\"attr\">DEPLOY_KEY:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.DEPLOY_KEY</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">          sudo timedatectl set-timezone &quot;Asia/Shanghai&quot;</span></span><br><span class=\"line\"><span class=\"string\">          mkdir -p ~/.ssh</span></span><br><span class=\"line\"><span class=\"string\">          echo &quot;$DEPLOY_KEY&quot; &gt; ~/.ssh/id_rsa</span></span><br><span class=\"line\"><span class=\"string\">          chmod 600 ~/.ssh/id_rsa</span></span><br><span class=\"line\"><span class=\"string\">          ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts</span></span><br><span class=\"line\"><span class=\"string\">          git config --global user.name &quot;xweiba&quot;</span></span><br><span class=\"line\"><span class=\"string\">          git config --global user.email &quot;xiaoweiba1028@gmail.com&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span>      <span class=\"comment\"># 生成并部署</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Deploy</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\">          <span class=\"string\">npx</span> <span class=\"string\">hexo</span> <span class=\"string\">clean</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">npx</span> <span class=\"string\">hexo</span> <span class=\"string\">d</span> <span class=\"string\">-g</span> </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"部署\"><a href=\"#部署\" class=\"headerlink\" title=\"部署\"></a>部署</h2><p>只要 <code>source</code> 分支有修改就会触发仓库 <code>Actions</code> 的 <code>Workflows</code> 自动部署静态文件:</p>\n<img src=\"/post/%E5%B0%86hexo%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2%E4%BB%8ETravis-CI%E8%BF%81%E7%A7%BB%E8%87%B3GitHub-Actions/image-20220228100502297.png\" class=\"\" title=\"image-20220228100502297\">\n","text":" 很久没更新博客了，今天想更新一下发现构建失败，看了下是因为 Travis CI 开始商业化了，我的免费额度早就用完了，正好现在都在玩 GitHub Actio...","permalink":"/post/将hexo自动构建部署从Travis-CI迁移至GitHub-Actions","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"Hexo","slug":"Hexo","count":4,"path":"api/categories/Hexo.json"},{"name":"GitHub","slug":"Hexo/GitHub","count":1,"path":"api/categories/Hexo/GitHub.json"}],"tags":[{"name":"Hexo","slug":"Hexo","count":5,"path":"api/tags/Hexo.json"},{"name":"Travis CI","slug":"Travis-CI","count":2,"path":"api/tags/Travis-CI.json"},{"name":"GitHub Actions","slug":"GitHub-Actions","count":1,"path":"api/tags/GitHub-Actions.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Hexo-%E6%B7%BB%E5%8A%A0-Git-%E9%83%A8%E7%BD%B2%E4%BE%9D%E8%B5%96\"><span class=\"toc-text\">Hexo 添加 Git 部署依赖</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E9%83%A8%E7%BD%B2%E5%AF%86%E9%92%A5\"><span class=\"toc-text\">配置部署密钥</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%BC%96%E5%86%99-Workflow\"><span class=\"toc-text\">编写 Workflow</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%83%A8%E7%BD%B2\"><span class=\"toc-text\">部署</span></a></li></ol>","author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Windows Git 和 CMD 终端代理设置","uid":"02595caed2c9ad700f77441184d5f61b","slug":"Windows-Git和CMD-的命令行代理设置","date":"2022-02-28T02:10:42.000Z","updated":"2025-04-30T08:11:18.865Z","comments":true,"path":"api/articles/Windows-Git和CMD-的命令行代理设置.json","keywords":null,"cover":null,"text":" 国内现在访问 git 速度太慢了，记录下配置的代理，来自 Windows git和cmd代理设置 配置代理代理类型是 http 值为: http://127....","permalink":"/post/Windows-Git和CMD-的命令行代理设置","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[{"name":"代理","slug":"代理","count":1,"path":"api/categories/代理.json"}],"tags":[{"name":"cmd","slug":"cmd","count":3,"path":"api/tags/cmd.json"},{"name":"Git","slug":"Git","count":3,"path":"api/tags/Git.json"},{"name":"windows","slug":"windows","count":2,"path":"api/tags/windows.json"},{"name":"proxy","slug":"proxy","count":1,"path":"api/tags/proxy.json"},{"name":"SOCKS","slug":"SOCKS","count":1,"path":"api/tags/SOCKS.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Arthas - 反编译class并热更新","uid":"3e8de84b59beb071f84ad0a51ed69a69","slug":"Arthas - 反编译class并热更新","date":"2021-06-30T04:16:42.000Z","updated":"2025-04-30T08:11:18.831Z","comments":true,"path":"api/articles/Arthas - 反编译class并热更新.json","keywords":null,"cover":null,"text":"1.反编译jad –source-only com.enableets.edu.paper.framework.service.TransformPaperSe...","permalink":"/post/Arthas - 反编译class并热更新","photos":[],"count_time":{"symbolsCount":679,"symbolsTime":"1 mins."},"categories":[{"name":"Arthas","slug":"Arthas","count":2,"path":"api/categories/Arthas.json"}],"tags":[{"name":"Arthas","slug":"Arthas","count":2,"path":"api/tags/Arthas.json"},{"name":"debug","slug":"debug","count":1,"path":"api/tags/debug.json"},{"name":"调试","slug":"调试","count":1,"path":"api/tags/调试.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}