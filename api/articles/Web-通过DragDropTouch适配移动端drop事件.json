{"title":"Web-通过DragDropTouch适配移动端drop事件","uid":"7439aff8f53103a2ebd62b031bb6dedb","slug":"Web-通过DragDropTouch适配移动端drop事件","date":"2021-06-10T05:43:38.000Z","updated":"2025-04-30T08:11:18.865Z","comments":true,"path":"api/articles/Web-通过DragDropTouch适配移动端drop事件.json","keywords":null,"cover":null,"content":"<p><a href=\"https://github.com/Bernardo-Castilho/dragdroptouch\">DragDropTouch-Github</a></p>\n<p>最近碰到一个bug,移动dom的<code>drag</code>事件在手机端没有反应, 查了一下<code>drag</code>是鼠标的相关<code>api</code>, 而手机端只有<code>touch</code>事件. </p>\n<p>需求比较急, 而且我也只是个xx后端, 找了个开源的插件, 适配一下 ok 啦</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/*</span><br><span class=\"line\">* Drag and drop questions</span><br><span class=\"line\">* */</span><br><span class=\"line\"></span><br><span class=\"line\">var QuestionDragDrop = window.QuestionDragDrop = &#123;</span><br><span class=\"line\">    dropImage: function(event) &#123;</span><br><span class=\"line\">        var _this = this;</span><br><span class=\"line\">        event.preventDefault();</span><br><span class=\"line\">        var srcHtml = event.dataTransfer.getData(&quot;text/html&quot;);</span><br><span class=\"line\">        var type = $(srcHtml).attr(&quot;type&quot;);</span><br><span class=\"line\">        if (type == &quot;answerImage&quot;) &#123;</span><br><span class=\"line\">            var srcImgUrl = $(srcHtml).attr(&quot;src&quot;);</span><br><span class=\"line\">            var answerId = $(srcHtml).attr(&quot;answerId&quot;);</span><br><span class=\"line\">            $(event.target).attr(&quot;src&quot;, srcImgUrl);</span><br><span class=\"line\">            $(event.target).attr(&quot;answerId&quot;, answerId);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    allowDropImage: function(event) &#123;</span><br><span class=\"line\">        event.preventDefault();</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    getUserAnswer: function (settings) &#123;</span><br><span class=\"line\">        var $this = settings.questionNode.userAnswer.$answer;</span><br><span class=\"line\">        var questionArea = $($this).parent().parent();</span><br><span class=\"line\">        var answerArr = [];</span><br><span class=\"line\">        var ret = false;</span><br><span class=\"line\">        questionArea.find(&quot;.question_content img.question_blank_image_area&quot;).each(function()&#123;</span><br><span class=\"line\">            var answerid = $(this).attr(&quot;answerid&quot;);</span><br><span class=\"line\">            if (!CommUtils.isEmpty(answerid))&#123;</span><br><span class=\"line\">                answerArr.push(answerid);</span><br><span class=\"line\">                ret = true;</span><br><span class=\"line\">            &#125;else&#123;</span><br><span class=\"line\">                answerArr.push(&quot; &quot;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        return ret ? answerArr.join(&quot;,&quot;) : &#x27;&#x27;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    tranToDragQuestion: function(question, isMerge) &#123; // Drag and drop question processing, generate random options</span><br><span class=\"line\">        var _this = this;</span><br><span class=\"line\">        if (CommUtils.isEmpty(question) || question.type.code !== &quot;39&quot; ||</span><br><span class=\"line\">            CommUtils.isEmpty(question.stem.plaintext) ||</span><br><span class=\"line\">            CommUtils.isEmpty(question.answer.lable)) return question;</span><br><span class=\"line\">        var blankImageMap = JSON.parse(question.stem.plaintext);</span><br><span class=\"line\">        var liTemplate = &quot;&lt;span style=&#x27;display: inline; width: 200px; height: 100px; margin: 0px 10px 50px 10px;&#x27; &quot; +</span><br><span class=\"line\">            &quot;class=&#x27;question_blank_image_area&#x27;&gt;&quot; +</span><br><span class=\"line\">            &quot;&lt;img style=&#x27;max-width: 230px !important; max-height: 100px; border: 1px solid #42a3f5; margin-right: 20px; margin-bottom: 20px;&#x27; &quot; +</span><br><span class=\"line\">            &quot;type=&#x27;answerImage&#x27; answerId=&#x27;&#123;0&#125;&#x27; src=&#x27;&#123;1&#125;&#x27;&gt;&quot; +</span><br><span class=\"line\">            &quot;&lt;/span&gt;&quot;;</span><br><span class=\"line\">        var keys = [];</span><br><span class=\"line\">        if (question.answer.lable.indexOf(&quot;@&quot;) &gt; 0) &#123;</span><br><span class=\"line\">            keys = question.answer.lable.split(&quot;@#@&quot;);</span><br><span class=\"line\">        &#125; else if (question.answer.lable.indexOf(&quot;,&quot;) &gt; 0) &#123;</span><br><span class=\"line\">            keys = question.answer.lable.split(&quot;,&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        keys.sort(function () &#123;</span><br><span class=\"line\">            return Math.random() &gt; 0.5 ? -1 : 1;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        var richText = &quot;&quot;;</span><br><span class=\"line\">        $.each(keys,function (index,key) &#123;</span><br><span class=\"line\">            var blankImage = blankImageMap[key];</span><br><span class=\"line\">            richText += CommUtils.formatStr(liTemplate, key, blankImage.file.url);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        if (isMerge) &#123;</span><br><span class=\"line\">            question.stem.richText += (&quot;&lt;div style=&#x27;margin: 5px 5px 5px 5px; width: 100%;&#x27; class=&#x27;question_blank_image_option&#x27; data-key=&#x27;&quot; + question.questionId +&quot;&#x27;&gt;&quot; + richText + &quot;&lt;/div&gt;&quot;);</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            question.stem.richTextOpt = (&quot;&lt;div style=&#x27;margin: 5px 5px 5px 5px; width: 100%;&#x27; class=&#x27;question_blank_image_option&#x27; data-key=&#x27;&quot; + question.questionId +&quot;&#x27;&gt;&quot; + richText + &quot;&lt;/div&gt;&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return question;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    textBecomeImg: function (text, fontcolor, fontsize, imgWidth, x, y)&#123; // use canvas to convert text to pictures</span><br><span class=\"line\">        var canvas = document.createElement(&#x27;canvas&#x27;);</span><br><span class=\"line\">        //Less than 32 words plus 1, less than 60 words plus 2, less than 80 words plus 4, less than 100 words plus 6</span><br><span class=\"line\">        var buHeight = 0;</span><br><span class=\"line\">        if(fontsize &lt;= 32)&#123; buHeight = 1; &#125;</span><br><span class=\"line\">        else if(fontsize &gt; 32 &amp;&amp; fontsize &lt;= 60 )&#123; buHeight = 2;&#125;</span><br><span class=\"line\">        else if(fontsize &gt; 60 &amp;&amp; fontsize &lt;= 80 )&#123; buHeight = 4;&#125;</span><br><span class=\"line\">        else if(fontsize &gt; 80 &amp;&amp; fontsize &lt;= 100 )&#123; buHeight = 6;&#125;</span><br><span class=\"line\">        else if(fontsize &gt; 100 )&#123; buHeight = 10;&#125;</span><br><span class=\"line\">        //For g j etc. sometimes there will be occlusion, here add some height</span><br><span class=\"line\">        canvas.height=fontsize + buHeight ;</span><br><span class=\"line\">        var context = canvas.getContext(&#x27;2d&#x27;);</span><br><span class=\"line\">        //Erase the rectangle with the position size of (0,0) 200 x 200, erase means to make the area transparent</span><br><span class=\"line\">        context.clearRect(0, 0, canvas.width, canvas.height);</span><br><span class=\"line\">        context.fillStyle = fontcolor;</span><br><span class=\"line\">        context.font=fontsize+&quot;px Arial&quot;;</span><br><span class=\"line\">        //top (top alignment) hanging (middle alignment) bottom (bottom alignment) alphabetic is the default</span><br><span class=\"line\">        context.textBaseline = &#x27;middle&#x27;;</span><br><span class=\"line\">        context.fillText(text,0,fontsize/2)</span><br><span class=\"line\"></span><br><span class=\"line\">        //If the width and height are set directly here, the content will be lost, and the cause has not been found for the time being, you can temporarily solve it with the following scheme</span><br><span class=\"line\">        //canvas.width = context.measureText(text).width;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        //Option 1: You can copy the content first, then set the width, and then paste</span><br><span class=\"line\">        //Option 2: Create a new canvas and paste the old canvas content</span><br><span class=\"line\">        //Option 3: After setting the width on the top, set the text again</span><br><span class=\"line\"></span><br><span class=\"line\">        //Solution 1: After testing, there is a problem. After the font becomes larger, the display is not complete. The reason is that the default width of the canvas is not enough.</span><br><span class=\"line\">        //If you give the canvas a large width at the beginning, this is fine.</span><br><span class=\"line\">        //var imgData = context.getImageData(0,0,canvas.width,canvas.height);  first copy the content in the original canvas</span><br><span class=\"line\">        //canvas.width = context.measureText(text).width;  then set the width and height</span><br><span class=\"line\">        //context.putImageData(imgData,0,0); //paste the copied content last</span><br><span class=\"line\"></span><br><span class=\"line\">        //Option 3: After changing the size, reset the text once</span><br><span class=\"line\">        if (imgWidth) &#123;</span><br><span class=\"line\">            canvas.width = imgWidth;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            canvas.width = context.measureText(text).width;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        context.fillStyle = fontcolor;</span><br><span class=\"line\">        context.font=fontsize+&quot;px Arial&quot;;</span><br><span class=\"line\">        context.textBaseline = &#x27;middle&#x27;;</span><br><span class=\"line\">        if (x &amp;&amp; y) &#123;</span><br><span class=\"line\">            context.fillText(text,x,y)</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            context.fillText(text,0,fontsize/2)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        var dataUrl = canvas.toDataURL(&#x27;image/png&#x27;);//Note that if the background is transparent, you need to use png</span><br><span class=\"line\">        return dataUrl;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    dropImageMobile: function (event) &#123;</span><br><span class=\"line\">        console.log(&quot;dropImageMobile&quot;);</span><br><span class=\"line\">        var _this = this;</span><br><span class=\"line\">        var type = $(questionDragDropMoveDomTarget).attr(&quot;type&quot;);</span><br><span class=\"line\">        if (questionDragDropMoveDomTarget == undefined || event.target == questionDragDropMoveDomTarget || $(event.target).attr(&quot;type&quot;) == &quot;answerImage&quot;) return;</span><br><span class=\"line\">        event.preventDefault();</span><br><span class=\"line\">        if (type == &quot;answerImage&quot;) &#123;</span><br><span class=\"line\">            var srcImgUrl = $(questionDragDropMoveDomTarget).attr(&quot;src&quot;);</span><br><span class=\"line\">            var answerId = $(questionDragDropMoveDomTarget).attr(&quot;answerId&quot;);</span><br><span class=\"line\">            $(event.currentTarget).attr(&quot;src&quot;, srcImgUrl);</span><br><span class=\"line\">            $(event.currentTarget).attr(&quot;answerId&quot;, answerId);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    dragstartMobile: function (event, type) &#123;</span><br><span class=\"line\">        console.log(&quot;dragstartMobile&quot;);</span><br><span class=\"line\">        window.questionDragDropMoveDomTarget = event.target;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    dragenter: function (event, type) &#123;</span><br><span class=\"line\">        console.log(&quot;dragenter&quot;);</span><br><span class=\"line\">        console.log(event.dataTransfer);</span><br><span class=\"line\">        console.log(event.target.currentSrc);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    dragleave: function (event, type) &#123;</span><br><span class=\"line\">        console.log(&quot;dragleave&quot;);</span><br><span class=\"line\">        console.log(event.dataTransfer);</span><br><span class=\"line\">        console.log(event.target.currentSrc);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    dragend: function (event, type) &#123;</span><br><span class=\"line\">        console.log(&quot;dragend&quot;);</span><br><span class=\"line\">        console.log(event.dataTransfer);</span><br><span class=\"line\">        console.log(event.target.currentSrc);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    isMobile: function () &#123;</span><br><span class=\"line\">        var userAgentInfo = navigator.userAgent;</span><br><span class=\"line\">        var mobileAgents = [&quot;Android&quot;, &quot;iPhone&quot;, &quot;SymbianOS&quot;, &quot;Windows Phone&quot;, &quot;iPad&quot;, &quot;iPod&quot;];</span><br><span class=\"line\">        var mobile_flag = false;</span><br><span class=\"line\"></span><br><span class=\"line\">        //根据userAgent判断是否是手机</span><br><span class=\"line\">        for (var v = 0; v &lt; mobileAgents.length; v++) &#123;</span><br><span class=\"line\">            if (userAgentInfo.indexOf(mobileAgents[v]) &gt; 0) &#123;</span><br><span class=\"line\">                mobile_flag = true;</span><br><span class=\"line\">                break;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        var screen_width = window.screen.width;</span><br><span class=\"line\">        var screen_height = window.screen.height;</span><br><span class=\"line\">        //根据屏幕分辨率判断是否是手机</span><br><span class=\"line\">        if (screen_width &lt; 500 &amp;&amp; screen_height &lt; 800) &#123;</span><br><span class=\"line\">            mobile_flag = true;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return mobile_flag;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    initMobileEvent: function (isEvent) &#123;</span><br><span class=\"line\">        for (var imgDom of $(&quot;.question_blank_image_area img[type=&#x27;answerImage&#x27;]&quot;)) &#123;</span><br><span class=\"line\">            if (isEvent) &#123;</span><br><span class=\"line\">                if (QuestionDragMobileMap.get(imgDom) != undefined) return;</span><br><span class=\"line\">                QuestionDragMobileMap.set(imgDom, true);</span><br><span class=\"line\">                $(imgDom).unbind();</span><br><span class=\"line\">                $(imgDom).attr(&quot;draggable&quot;, &quot;draggableTouch&quot;);// 注意只有有`draggable`属性的节点才会被处理, 这里值只是做个标记</span><br><span class=\"line\">                imgDom.addEventListener(&#x27;dragstart&#x27;, QuestionDragDrop.dragstartMobile, false);</span><br><span class=\"line\">                imgDom.addEventListener(&#x27;dragenter&#x27;, QuestionDragDrop.dropImageMobile, false)</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                if (!QuestionDragMobileMap.get(imgDom) != undefined) return;</span><br><span class=\"line\">                QuestionDragMobileMap.delete(imgDom);</span><br><span class=\"line\">                imgDom.removeEventListener(&#x27;dragstart&#x27;, QuestionDragDrop.dragstartMobile, false);</span><br><span class=\"line\">                imgDom.removeEventListener(&#x27;dragenter&#x27;, QuestionDragDrop.dropImageMobile, false)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        for (var imgDom of $(&quot;img.stem.question_blank_image_area&quot;)) &#123;</span><br><span class=\"line\">            if (isEvent) &#123;</span><br><span class=\"line\">                if (QuestionDragMobileMap.get(imgDom)) return;</span><br><span class=\"line\">                QuestionDragMobileMap.delete(imgDom, true);</span><br><span class=\"line\">                $(imgDom).unbind();</span><br><span class=\"line\">                $(imgDom).attr(&quot;draggable&quot;, &quot;draggableTouch&quot;);</span><br><span class=\"line\">                imgDom.addEventListener(&#x27;dragstart&#x27;, QuestionDragDrop.dragstartMobile, false);</span><br><span class=\"line\">                imgDom.addEventListener(&#x27;dragenter&#x27;, QuestionDragDrop.dropImageMobile, false);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                if (!QuestionDragMobileMap.get(imgDom)) return;</span><br><span class=\"line\">                QuestionDragMobileMap.delete(imgDom);</span><br><span class=\"line\">                imgDom.removeEventListener(&#x27;dragstart&#x27;, QuestionDragDrop.dragstartMobile, false);</span><br><span class=\"line\">                imgDom.removeEventListener(&#x27;dragenter&#x27;, QuestionDragDrop.dropImageMobile, false)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            console.log(&quot;change&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">window.QuestionDragMobileMap = new Map();</span><br><span class=\"line\">$(function () &#123;</span><br><span class=\"line\">    if (QuestionDragDrop.isMobile()) &#123;</span><br><span class=\"line\">        $(&quot;body&quot;).bind(&quot;DOMSubtreeModified&quot;, function () &#123;</span><br><span class=\"line\">            QuestionDragDrop.initMobileEvent(false);</span><br><span class=\"line\">            QuestionDragDrop.initMobileEvent(true);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>","text":"DragDropTouch-Github 最近碰到一个bug,移动dom的drag事件在手机端没有反应, 查了一下drag是鼠标的相关api, 而手机端只有to...","permalink":"/post/Web-通过DragDropTouch适配移动端drop事件","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[{"name":"Web","slug":"Web","count":2,"path":"api/categories/Web.json"}],"tags":[{"name":"Web","slug":"Web","count":2,"path":"api/tags/Web.json"},{"name":"移动端","slug":"移动端","count":1,"path":"api/tags/移动端.json"},{"name":"适配","slug":"适配","count":1,"path":"api/tags/适配.json"}],"toc":"","author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Arthas - 反编译class并热更新","uid":"3e8de84b59beb071f84ad0a51ed69a69","slug":"Arthas - 反编译class并热更新","date":"2021-06-30T04:16:42.000Z","updated":"2025-04-30T08:11:18.831Z","comments":true,"path":"api/articles/Arthas - 反编译class并热更新.json","keywords":null,"cover":null,"text":"1.反编译jad –source-only com.enableets.edu.paper.framework.service.TransformPaperSe...","permalink":"/post/Arthas - 反编译class并热更新","photos":[],"count_time":{"symbolsCount":679,"symbolsTime":"1 mins."},"categories":[{"name":"Arthas","slug":"Arthas","count":2,"path":"api/categories/Arthas.json"}],"tags":[{"name":"Arthas","slug":"Arthas","count":2,"path":"api/tags/Arthas.json"},{"name":"debug","slug":"debug","count":1,"path":"api/tags/debug.json"},{"name":"调试","slug":"调试","count":1,"path":"api/tags/调试.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Nginx 相关","uid":"5b3fd36ba58de8c4f5cd292f46984b8d","slug":"Nginx 相关","date":"2021-05-18T05:07:23.000Z","updated":"2025-04-30T08:11:18.862Z","comments":true,"path":"api/articles/Nginx 相关.json","keywords":null,"cover":null,"text":"直接返回文件内容12345678910location ^~ /get_json_file{ default_type application/json; ad...","permalink":"/post/Nginx 相关","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"Nginx","slug":"Nginx","count":1,"path":"api/categories/Nginx.json"}],"tags":[{"name":"Nginx","slug":"Nginx","count":1,"path":"api/tags/Nginx.json"}],"author":{"name":"Weiba","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/24520686?v=4","link":"/","description":"啊 又忘了更新了！","socials":{"github":"https://github.com/xweiba","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}